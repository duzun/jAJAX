/*
 MIT
  @version 1.5.0
  @git https://github.com/duzun/jAJAX
  @umd AMD, Browser, CommonJs
  @author Dumitru Uzun (https://DUzun.Me)
*/
(function(m,e){"object"===typeof exports&&"undefined"!==typeof module?module.exports=e():"function"===typeof define&&define.amd?define(e):(m=m||self,m.jajax=e())})(this,function(){function m(a){m="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return m(a)}function e(a,l,b,k){"String"==v(a)&&(l&&"Object"==v(l)?(l.url=a,a=l,l=b,b=k):a={url:a});
a=L({url:"",type:"GET",cache:!1,timeout:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"",mimeType:"",data:null,headers:null,error:null,success:null},a);!l&&a.success&&(l=a.success,delete a.success);!b&&a.error&&(b=a.error,delete a.error);var c=e.createXHR(!1);if(!c)return b&&b(null,"xhr",Error("Couldn't create XHR object")),c;var m={};k=function(a,g){m[a.toLowerCase()]=[a,g]};var h=a.method||a.type,d=a.url,w,p,x,C,y=function(f,g,d,c){f||(f=d&&d.statusText)||(f="jajax error: ".concat(g||
"unknown"));"string"==typeof f&&(f=Error(f));f&&(g&&(f.type=g),d&&d.status&&(f.status=d.status));a.error&&a.error(d||c,g,f,c);b&&b(d||c,g,f,c);C&&(f&&(f.xhr=d||c,f.response=c),C(f))},N=function(f,g,d){var b=a.dataType||a.mimeType&&e.mimeToDataType(a.mimeType)||p;try{switch(b){case "json":g="responseJSON"in f?f.responseJSON:H.test(g)?null:e.parseJSON(g);break;case "xml":g=f.responseXML;break;case "script":H.test(g)||(0,eval)(g)}}catch(M){var c=M}c?y(c,"parsererror",f,d):(a.success&&a.success(g,f.statusText,
f,d),l&&l(g,f.statusText,f,d),x&&x(g))},D=function(a,d){w&&O(w);var f=a.responseText||a.response;p=e.mimeToDataType(a.getResponseHeader("content-type"));if("json"==p&&!("responseJSON"in a))if(/^\s*$/.test(f))a.responseJSON=null;else try{a.responseJSON=e.parseJSON(f)}catch(S){}200<=a.status&&300>a.status||304==a.status?N(a,f,d):y(a.statusText||null,a.status?"error":"abort",a,d)};if(!l&&!b&&"function"==typeof Promise){var u=new Promise(function(a,d){x=a;C=d});var t=u.then.bind(u);u=u["catch"].bind(u)}n({"X-Requested-With":"XMLHttpRequest",
Accept:(I[a.dataType]?I[a.dataType]+", ":"")+"*/*; q=0.01"},k);a.contentType&&k("Content-Type",a.contentType);n(a.headers,k);h=h.toLowerCase();!a.data||"get"!=h&&"head"!=h||(d+=(0>d.indexOf("?")?"?":"&")+e.param(a.data),a.data=null);if("REQUEST"==e.xhr_type){n(a.data,function(a,d,b){null==d&&delete b[a]});var r={url:d,content:a.data||{},headers:{},onComplete:function(a){r.aborted||D({getResponseHeader:function(d){return a.headers[d]},status:a.status,statusText:a.statusText,responseText:a.text,responseJSON:a.json},
a)}};n(m,function(a,d){d[0]&&null!=d[0]&&(r.headers[d[0]]=d[1])});a.contentType&&(r.contentType=a.contentType);0<a.timeout&&(w=E(function(){r.aborted=P();y(null,"timeout",c)},a.timeout));try{var q=c.Request(r);q[h]()}catch(f){try{r.headers["X-HTTP-Method-Override"]=h.toUpperCase(),q=c.Request(r),q.post()}catch(g){switch(h){case "delete":q=new (require("sdk/net/xhr").XMLHttpRequest);q.open(h,d);n(r.headers,function(a,d){q.setRequestHeader(a,d)});q.send();D(q);break;default:throw g;}}}q&&(c=q)}else c.open(h,
d,!0),n(m,function(a,d){null!=d[1]&&c.setRequestHeader(d[0],d[1]+"")}),0<a.timeout&&(w=E(function(){c.onreadystatechange=J;c.abort();y(null,"timeout",c)},a.timeout)),k=function(){4==c.readyState&&(c.onreadystatechange=J,D(c))},c.send(a.data?"string"==typeof a.data?a.data:e.param(a.data):null),4===c.readyState?E(k):c.onreadystatechange=k;t&&!c.then&&(c.then=t,u&&(c["catch"]=u));return c}function v(a){return null===a?"Null":a===Q?"Undefined":R.call(a).slice(8,-1)}function t(a){return a instanceof Function||
"Function"==v(a)}function K(a){return F.call(a,"length")&&"number"===typeof a.length&&!t(a)}function n(a,e){if(!a)return a;if(z(a)||K(a))for(var b=0,k=a.length>>>0;b<k;b++){if(F.call(a,b)){var c=a[b];if(!1===e.call(c,b,c,a))return b}}else for(b in a)if(F.call(a,b)&&(k=a[b],!1===e.call(k,b,k,a)))return b;return a}function L(a){var e=function(b,e){a[b]=e};n(arguments,function(a,k){a&&n(k,e)});return a}var A="undefined"==typeof globalThis?"undefined"==typeof global?self:global:globalThis,Q,J=function(){},
G=Object.prototype,F=G.hasOwnProperty,R=G.toString,P="function"==typeof Date.now?function(){return Date.now()}:function(){return new Date.getTime},z=t(Array.isArray)?Array.isArray:Array.isArray=function(a){return a instanceof Array||"Array"==v(a)},B="undefined"!==typeof self&&t(self.setTimeout)?self:A;t(B.setTimeout)||"undefined"!==typeof require&&(B=require("sdk/timers"));var E=B.setTimeout,O=B.clearTimeout,H=/^\s*$/,I={"*":"*/*",text:"text/plain",html:"text/html",xml:"application/xml, text/xml",
json:"application/json, text/javascript"};(function(a,e,b){function k(a,b,c,e){var d=z(b),l=b&&b!==A&&!d&&Object.getPrototypeOf(b)===G;n(b,function(b,h){var p=z(h)?"array":m(h);e&&(b=c?e:e+"["+(l||"object"==p||"array"==p?b:"")+"]");!e&&d?a.add(h.name,h.value):"array"==p||!c&&"object"==p?k(a,h,c,b):a.add(b,h)})}b.param=function(d,b){var c=[];c.add=function(d,b){this.push(a(d)+(null==b?"":"="+a(b)))};k(c,d,b);return c.join("&").replace(/%20/g,"+")};var c=/^(?:text|application)\/javascript/i,l=/^(?:text|application)\/xml/i;
b.mimeToDataType=function(a){a&&(a=a.split(";",2)[0]);return a&&("text/html"==a?"html":"application/json"==a?"json":c.test(a)?"script":l.test(a)&&"xml")||"text"};var h=e&&e.parse||A.json_decode;b.parseJSON=function(a){try{return h(a)}catch(p){var b=a.replace(/[\n\r]+\s*\/\/[^\n\r]*/g,"");if(b!=a)return h(b);throw p;}};b.createXHR=function(a){n({XMLHttpRequest:function(){return new A.XMLHttpRequest},MSXML2:function(){return new ActiveXObject("Msxml2.XMLHTTP")},MSXML:function(){return new ActiveXObject("Microsoft.XMLHTTP")},
MSXML24:function(){return new ActiveXObject("Msxml2.XMLHTTP.4.0")},REQUEST:function(){return require("sdk/request")},node_XMLHttpRequest:function(){return new (require("xmlhttprequest").XMLHttpRequest)}},function(d,c){try{return a=c(),b.createXHR=c,b.xhr_type=d,!1}catch(x){}});return a};b.xhr_supported=b.createXHR(!1)})(encodeURIComponent,JSON,e);e.version="1.5.0";e.each=n;e.type=v;e.isFunction=t;e.isArray=z;e.isArrayLike=K;return e});
