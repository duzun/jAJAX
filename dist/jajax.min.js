/*
 MIT
  @version 1.5.1
  @git https://github.com/duzun/jAJAX
  @author Dumitru Uzun (https://DUzun.Me)
*/
(function(m,h){"object"===typeof exports&&"undefined"!==typeof module?module.exports=h():"function"===typeof define&&define.amd?define(h):(m=m||self,m.jajax=h())})(this,function(){function m(a){m="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return m(a)}function h(a,f,b,g){"String"==v(a)&&(f&&"Object"==v(f)?(f.url=a,a=f,f=b,b=g):a={url:a});
a=C({url:"",type:"GET",cache:!1,timeout:null,contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"",mimeType:"",data:null,headers:null,error:null,success:null},a);!f&&a.success&&(f=a.success,delete a.success);!b&&a.error&&(b=a.error,delete a.error);var c=h.createXHR(!1);if(!c)return b&&b(null,"xhr",Error("Couldn't create XHR object")),c;var m={};g=function(a,k){m[a.toLowerCase()]=[a,k]};var l=a.method||a.type,d=a.url,w,p,x,D,y=function(e,k,d,c){e||(e=d&&d.statusText)||(e="jajax error: ".concat(k||
"unknown"));"string"==typeof e&&(e=Error(e));e&&(k&&(e.type=k),d&&d.status&&(e.status=d.status));a.error&&a.error(d||c,k,e,c);b&&b(d||c,k,e,c);D&&(e&&(e.xhr=d||c,e.response=c),D(e))},N=function(e,k,d){var b=a.dataType||a.mimeType&&h.mimeToDataType(a.mimeType)||p;try{switch(b){case "json":k="responseJSON"in e?e.responseJSON:J.test(k)?null:h.parseJSON(k);break;case "xml":k=e.responseXML;break;case "script":J.test(k)||(0,eval)(k)}}catch(M){var c=M}c?y(c,"parsererror",e,d):(a.success&&a.success(k,e.statusText,
e,d),f&&f(k,e.statusText,e,d),x&&x(k))},E=function(a,d){w&&O(w);var e=a.responseText||a.response;p=h.mimeToDataType(a.getResponseHeader("content-type"));if("json"==p&&!("responseJSON"in a))if(/^\s*$/.test(e))a.responseJSON=null;else try{a.responseJSON=h.parseJSON(e)}catch(S){}200<=a.status&&300>a.status||304==a.status?N(a,e,d):y(a.statusText||null,a.status?"error":"abort",a,d)};if(!f&&!b&&"function"==typeof Promise){var u=new Promise(function(a,d){x=a;D=d});var t=u.then.bind(u);u=u["catch"].bind(u)}n({"X-Requested-With":"XMLHttpRequest",
Accept:(F[a.dataType]?F[a.dataType]+", ":"")+"*/*; q=0.01"},g);a.contentType&&g("Content-Type",a.contentType);n(a.headers,g);l=l.toLowerCase();!a.data||"get"!=l&&"head"!=l||(d+=(0>d.indexOf("?")?"?":"&")+h.param(a.data),a.data=null);if("REQUEST"==h.xhr_type){n(a.data,function(a,d,b){null==d&&delete b[a]});var r={url:d,content:a.data||{},headers:{},onComplete:function(a){r.aborted||E({getResponseHeader:function(d){return a.headers[d]},status:a.status,statusText:a.statusText,responseText:a.text,responseJSON:a.json},
a)}};n(m,function(a,d){d[0]&&null!=d[0]&&(r.headers[d[0]]=d[1])});a.contentType&&(r.contentType=a.contentType);0<a.timeout&&(w=G(function(){r.aborted=P();y(null,"timeout",c)},a.timeout));try{var q=c.Request(r);q[l]()}catch(e){try{r.headers["X-HTTP-Method-Override"]=l.toUpperCase(),q=c.Request(r),q.post()}catch(k){switch(l){case "delete":q=new (require("sdk/net/xhr").XMLHttpRequest);q.open(l,d);n(r.headers,function(a,d){q.setRequestHeader(a,d)});q.send();E(q);break;default:throw k;}}}q&&(c=q)}else c.open(l,
d,!0),n(m,function(a,d){null!=d[1]&&c.setRequestHeader(d[0],d[1]+"")}),0<a.timeout&&(w=G(function(){c.onreadystatechange=K;c.abort();y(null,"timeout",c)},a.timeout)),g=function(){4==c.readyState&&(c.onreadystatechange=K,E(c))},c.send(a.data?"string"==typeof a.data?a.data:h.param(a.data):null),4===c.readyState?G(g):c.onreadystatechange=g;t&&!c.then&&(c.then=t,u&&(c["catch"]=u));return c}function v(a){return null===a?"Null":a===Q?"Undefined":R.call(a).slice(8,-1)}function t(a){return a instanceof Function||
"Function"==v(a)}function L(a){return H.call(a,"length")&&"number"===typeof a.length&&!t(a)}function n(a,f){if(!a)return a;if(z(a)||L(a))for(var b=0,g=a.length>>>0;b<g;b++){if(H.call(a,b)){var c=a[b];if(!1===f.call(c,b,c,a))return b}}else for(b in a)if(H.call(a,b)&&(g=a[b],!1===f.call(g,b,g,a)))return b;return a}function C(a){var f=function(b,g){a[b]=g};n(arguments,function(a,g){a&&n(g,f)});return a}var A="undefined"==typeof globalThis?"undefined"==typeof global?self:global:globalThis,Q,K=function(){},
I=Object.prototype,H=I.hasOwnProperty,R=I.toString,P="function"==typeof Date.now?function(){return Date.now()}:function(){return new Date.getTime},z=t(Array.isArray)?Array.isArray:Array.isArray=function(a){return a instanceof Array||"Array"==v(a)},B="undefined"!==typeof self&&t(self.setTimeout)?self:A;t(B.setTimeout)||"undefined"!==typeof require&&(B=require("sdk/timers"));var G=B.setTimeout,O=B.clearTimeout,J=/^\s*$/,F={"*":"*/*",text:"text/plain",html:"text/html",xml:"application/xml, text/xml",
json:"application/json, text/javascript"};(function(a,f,b){function g(a,b,c,f){var d=z(b),h=b&&b!==A&&!d&&Object.getPrototypeOf(b)===I;n(b,function(b,l){var p=z(l)?"array":m(l);f&&(b=c?f:f+"["+(h||"object"==p||"array"==p?b:"")+"]");!f&&d?a.add(l.name,l.value):"array"==p||!c&&"object"==p?g(a,l,c,b):a.add(b,l)})}b.param=function(d,b){var c=[];c.add=function(d,b){this.push(a(d)+(null==b?"":"="+a(b)))};g(c,d,b);return c.join("&").replace(/%20/g,"+")};var c=/^(?:text|application)\/javascript/i,h=/^(?:text|application)\/xml/i;
b.mimeToDataType=function(a){a&&(a=a.split(";",2)[0]);return a&&("text/html"==a?"html":"application/json"==a?"json":c.test(a)?"script":h.test(a)&&"xml")||"text"};var l=f&&f.parse||A.json_decode;b.parseJSON=function(a){try{return l(a)}catch(p){var b=a.replace(/[\n\r]+\s*\/\/[^\n\r]*/g,"");if(b!=a)return l(b);throw p;}};b.createXHR=function(a){n({XMLHttpRequest:function(){return new A.XMLHttpRequest},MSXML2:function(){return new ActiveXObject("Msxml2.XMLHTTP")},MSXML:function(){return new ActiveXObject("Microsoft.XMLHTTP")},
MSXML24:function(){return new ActiveXObject("Msxml2.XMLHTTP.4.0")},REQUEST:function(){return require("sdk/request")},node_XMLHttpRequest:function(){return new (require("xmlhttprequest").XMLHttpRequest)}},function(d,c){try{return a=c(),b.createXHR=c,b.xhr_type=d,!1}catch(x){}});return a};b.xhr_supported=b.createXHR(!1)})(encodeURIComponent,JSON,h);C(h,{version:"1.5.1",accepts:F,each:n,extend:C,type:v,isFunction:t,isArray:z,isArrayLike:L});return h});
